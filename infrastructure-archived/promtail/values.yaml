promtail:
  config:
    clients:
    - url: http://loki-gateway.monitoring.svc.cluster.local:3100/loki/api/v1/push  # Added :3100
    
    positions:
      filename: /tmp/positions.yaml
    
    snippets:
      pipelineStages:
      - cri: {}
      
      common:
      - action: replace
        source_labels:
        - __meta_kubernetes_pod_node_name
        target_label: node_name
      - action: replace
        source_labels:
        - __meta_kubernetes_namespace
        target_label: namespace
      - action: replace
        source_labels:
        - __meta_kubernetes_pod_name
        target_label: pod
      - action: replace
        source_labels:
        - __meta_kubernetes_pod_container_name
        target_label: container
      - action: replace
        replacement: /var/log/pods/*$1/*.log
        separator: /
        source_labels:
        - __meta_kubernetes_pod_uid
        - __meta_kubernetes_pod_container_name
        target_label: __path__
      
      scrapeConfigs: |
        - job_name: kubernetes-pods
          kubernetes_sd_configs:
            - role: pod
          pipeline_stages:
            {{- toYaml .Values.config.snippets.pipelineStages | nindent 4 }}
          relabel_configs:
            {{- toYaml .Values.config.snippets.common | nindent 4 }}
  
  tolerations:
  - operator: Exists
    effect: NoSchedule
  
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m