kube-prometheus-stack:
  # Prometheus settings
  prometheus:
    enabled: true
    prometheusSpec:
      retention: 10m # keep 10 minutes of data
      storageSpec: {}  # No persistence
      resources:
        requests:
          memory: 512Mi
          cpu: 250m
      tolerations:
        - key: "monitoring"
          operator: "Equal"
          value: "true"
          effect: "NoSchedule"
      nodeSelector:
        monitoring: "true"

  # Grafana settings
  grafana:
    enabled: true
    adminPassword: admin  # Change this!
    
    # NO persistence
    persistence:
      enabled: false
    
    # Pre-built dashboards
    defaultDashboardsEnabled: true
  
    # ADD THIS SECTION - Loki data source
    additionalDataSources:
    - name: Loki
      type: loki
      access: proxy
      url: http://loki.monitoring.svc.cluster.local:3100
      isDefault: false
      editable: true
      jsonData:
        maxLines: 1000

    ingress:
      enabled: false  # We'll use our own ingress

    tolerations:
      - key: "monitoring"
        operator: "Equal"
        value: "true"
        effect: "NoSchedule"
    nodeSelector:
      monitoring: "true"
  
  # AlertManager
  alertmanager:
    enabled: true
    alertmanagerSpec:
      storage: {}  # No persistence
      tolerations:
        - key: "monitoring"
          operator: "Equal"
          value: "true"
          effect: "NoSchedule"
      nodeSelector:
        monitoring: "true"
